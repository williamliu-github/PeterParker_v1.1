<!DOCTYPE html>
<head>

<!-- Basic Page Needs
================================================== -->
<title>我的黑名單 | Peter Parker</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<!-- CSS
================================================== -->
<link rel="stylesheet" href="css/style.css">
<link rel="stylesheet" href="css/main-color.css" id="colors">
<script type="module" src="scripts/userinfo.js"></script>
<script type="module" src="scripts/get_photo.js"></script>
<link rel="icon" href="images/logo-icon.png" type="image/png">

</head>

<body>
<div id="loadingOverlay" class="overlay">
	<div class="spinner"></div>
	</div>

<!-- Wrapper -->
<div id="wrapper">

<!-- Header Container
================================================== -->
<header id="header-container" class="fixed fullwidth dashboard" >

	<!-- Header -->
	<div id="header" class="not-sticky">
		<div class="container">
			
			<!-- Left Side Content -->
			<div class="left-side">
				
				<!-- Logo -->
				<div id="logo">
					<a href="index.html"><img src="images/logo.png" alt=""></a>
					<a href="index.html" class="dashboard-logo"><img src="images/logo2.png" alt=""></a>
				</div>

				<!-- Mobile Navigation -->
				<div class="mmenu-trigger">
					<button class="hamburger hamburger--collapse" type="button">
						<span class="hamburger-box">
							<span class="hamburger-inner"></span>
						</span>
					</button>
				</div>

				<!-- Main Navigation -->
				<nav id="navigation" class="style-1">
					<ul id="responsive">

						<li><a href="index.html">首頁</a>
						</li>

						<li><a>如何使用</a>
							<ul>
								<li><a href="how_to_reserve.html">如何預約車位</a></li>
								<li><a href="dashboard-messages.html">如何出租車位</a></li>
							</ul>
						</li>

						<li><a>最新消息</a>
						</li>

						<li><a href="#">聯絡我們</a></li>

						<li><a href="#">業主登入</a></li>
							
						
					</ul>
				</nav>
				<div class="clearfix"></div>
				<!-- Main Navigation / End -->
				
			</div>
			<!-- Left Side Content / End -->

			<!-- Right Side Content / End -->
			<div class="right-side">
				<!-- Header Widget -->
				<div class="header-widget">
					
					<!-- User Menu -->
					<div class="user-menu">
						<div class="user-name"><span><img id="avatar-preview" src="images/dashboard-avatar.jpg" alt=""></span><p style="display:inline " id="username2"> 你好！</p></div>
						<ul>
							<li><a href="user_center.html"><i class="sl sl-icon-settings"></i>會員中心</a></li>
							<li><a href="user_profile.html"><i class="sl sl-icon-user"></i>個人資料</a></li>
							<li><a href="parking_map.html"><i class="sl sl-icon-control-play"></i>開始預約</a></li>
						</ul>
					</div>
					<a href="index.html" id="logout_btn" class="button border with-icon" onclick="localStorage.removeItem('peterParkerToken'); localStorage.removeItem('userId');"></i>會員登出</a>
					</div>
				</div>
				<!-- Header Widget / End -->
			</div>
			<!-- Right Side Content / End -->

		</div>
	</div>
	<!-- Header / End -->

</header>


<!-- Dashboard -->
<div id="dashboard">

<!-- Navigation
	================================================== -->

	<!-- Responsive Navigation Trigger -->
	<a href="#" class="dashboard-responsive-nav-trigger"><i class="fa fa-reorder"></i>會員中心功能選單</a>
	
	<div class="dashboard-nav">
		<div class="dashboard-nav-inner">

			<ul>
				<li><a href="user_center.html"><i class="sl sl-icon-settings"></i>會員中心</a></li>
				<li><a href="user_profile.html"><i class="sl sl-icon-user"></i>個人資料</a></li>
				<li><a href="parking_map.html"><i class="sl sl-icon-control-play"></i>開始預約</a></li>
				<li><a><i class="sl sl-icon-layers"></i>我的訂單</a>
					<ul>
						<li><a href="user_ongoing_reservation.html">未完成訂單</a></li>
						<li><a href="user_completed_reservation.html">已完成訂單</a></li>
						<li>
					</ul>	
				</li>
				<li><a href="user_my_favourites.html"><i class="sl sl-icon-heart"></i>我的最愛</a></li>
				<li class="active"><a href="user_my_blacklist.html"><i class="sl sl-icon-ban"></i>我的黑名單</a></li>
			</ul>	

	</div>
	</div>
	<!-- Navigation / End -->


	<!-- Content
	================================================== -->
	<div class="dashboard-content">

		<!-- Titlebar -->
		<div id="titlebar">
			<div class="row">
				<div class="col-md-12 headline centered margin-top-0">
					<h2>我的黑名單</h2>
				</div>
			</div>
		</div>

		<div class="row">
			
			<!-- Listings -->
			<div class="col-lg-12 col-md-12">
				<div class="dashboard-list-box margin-top-0">
					<h4>以下為您加入我的黑名單的停車場：</h4>
					<ul id="blacklist-list">

						<div stlye="display: flex;
						justify-content: center; /* Centers horizontally */
						align-items: center;     /* Centers vertically */
						height: 100vh; ">
						<img style="width: 100%"src="images/nothing-is-added-yet.png">
						<h4>還沒有任何車位加入黑名單喔！祝你預約車位愉快！</h4>
						</div>

					</ul>
				</div>
			</div>


			<!-- Copyrights -->
			<div class="col-md-12">
				<div class="copyrights">Copyright © 2024 Peter Parker | All Rights Reserved </div>
			</div>
		</div>

	</div>
	<!-- Content / End -->


</div>
<!-- Dashboard / End -->


</div>
<!-- Wrapper / End -->


<!-- Scripts
================================================== -->
<script type="text/javascript" src="scripts/jquery-3.6.0.min.js"></script>
<script type="text/javascript" src="scripts/jquery-migrate-3.3.2.min.js"></script>
<script type="text/javascript" src="scripts/mmenu.min.js"></script>
<script type="text/javascript" src="scripts/chosen.min.js"></script>
<script type="text/javascript" src="scripts/slick.min.js"></script>
<script type="text/javascript" src="scripts/rangeslider.min.js"></script>
<script type="text/javascript" src="scripts/magnific-popup.min.js"></script>
<script type="text/javascript" src="scripts/waypoints.min.js"></script>
<script type="text/javascript" src="scripts/counterup.min.js"></script>
<script type="text/javascript" src="scripts/jquery-ui.min.js"></script>
<script type="text/javascript" src="scripts/tooltips.min.js"></script>
<script type="text/javascript" src="scripts/custom.js"></script>
<script>

	window.onload = function (){
		let peterParkerToken = localStorage.getItem('peterParkerToken');

		if(!peterParkerToken){
			window.location.href='index.html';
		}
		
		fetchBlacklist(); // Call the function to fetch favourites on page load
	
	};

	function fetchBlacklist() {
    // Replace with your API endpoint
    
	let peterParkerToken = localStorage.getItem('peterParkerToken');

    fetch(`http://localhost:8081/user/findAllBlacklist`, {
        method: 'GET',
        headers: {
            'Authorization': `Bearer ${peterParkerToken}`,  // Include JWT in the Authorization header
            'Content-Type': 'application/json'
        }
    })
        .then(response => {
            if (response.status === 204) {
				console.log("No orders found for this user.");
			}
            return response.json();
        })
        .then(data => {
			if(data){
            const blacklistList = document.getElementById('blacklist-list');
            blacklistList.innerHTML = ''; // Clear existing content
            data.forEach(blacklist => {
                // Create a list item for each favourite
                const listItem = document.createElement('li');
                listItem.innerHTML = `
                   <div class="list-box-listing">
					<div class="list-box-listing-img"><a href="#"><img src="http://localhost:8081/user/image/${blacklist.parkingId}" alt="${blacklist.parkingName}"></a></div>
					<div class="list-box-listing-content">
						<div class="inner" style="padding-bottom:25px">
							<h3><a href="#">${blacklist.parkingName}</a></h3>
							<span>${blacklist.parkingLocation}</span>
							<h5>
								平日小時收費： ＄${blacklist.workdayHourlyRate} 
							</h5>
							<h5>
								假日小時收費： ＄${blacklist.holidayHourlyRate}
							</h5>
						</div>
					</div>
				</div>
				<div class="buttons-to-right">
					<a href="#" class="button gray" onclick="removeBlacklist(${blacklist.userBlacklistId})"><i class="sl sl-icon-close"></i>從我的黑名單中刪除</a>
				</div>
                `;
                blacklistList.appendChild(listItem); // Append the new item to the list
				
            });}
        })
        .catch(error => {
            console.error('Error fetching favourites:', error);
        })
		.finally(()=>{
		overlay.style.display = "none";
	});
}



function removeBlacklist(blacklistId) {
	console.log(blacklistId);
    // Replace with your API endpoint for removing a favourite
    let blacklistData = {
		userBlacklistId: blacklistId
	};

	const overlay = document.getElementById('loadingOverlay');
   	overlay.style.display = 'block';


    fetch(`http://localhost:8081/user/deleteBlacklist`, {
        method: 'DELETE',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(blacklistData)
    })
    .then(response => {
        if (response.ok) {
            fetchBlacklist(); // Refresh the favourites list
        } else {
            throw new Error('Failed to remove blacklist');
        }
    })
    .catch(error => {
        console.error('Error removing blacklist:', error);
    })
	.finally(()=>{
		overlay.style.display = "none";
	});
}
</script>

</body>
</html>