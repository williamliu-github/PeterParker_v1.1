<!DOCTYPE html>

<head>

	<!-- Basic Page Needs
================================================== -->
	<title>Listeo</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<!-- CSS
================================================== -->
	<link rel="stylesheet" href="css/style.css">
	<link rel="stylesheet" href="css/main-color.css" id="colors">
	
</head>

<body>

	<!-- Wrapper -->
	<div id="wrapper">

		<!-- Header Container
================================================== -->
		<header id="header-container" class="fixed fullwidth dashboard">

			<!-- Header -->
			<div id="header" class="not-sticky">
				<div class="container">

					<!-- Left Side Content -->
					<div class="left-side">

						<!-- Logo -->
						<div id="logo">
							<a href="index.html"><img src="images/logo.png" alt=""></a>
							<a href="index.html" class="dashboard-logo"><img src="images/logo2.png" alt=""></a>
						</div>

						<!-- Mobile Navigation -->
						<div class="mmenu-trigger">
							<button class="hamburger hamburger--collapse" type="button">
								<span class="hamburger-box">
									<span class="hamburger-inner"></span>
								</span>
							</button>
						</div>

						<!-- Main Navigation -->
						<nav id="navigation" class="style-1">
							<ul id="responsive">

								<li><a href="#">Home</a>
									<ul>
										<li><a href="index.html">Home 1 (Modern)</a></li>
										<li><a href="index-2.html">Home 2 (Default)</a></li>
										<li><a href="index-3.html">Home 3 (Airbnb)</a></li>
										<li><a href="index-4.html">Home 4 (Creative)</a></li>
										<li><a href="index-5.html">Home 5 (Slider)</a></li>
										<li><a href="index-6.html">Home 6 (Map)</a></li>
										<li><a href="index-7.html">Home 7 (Video)</a></li>
										<li><a href="index-8.html">Home 8 (Classic)</a></li>
									</ul>
								</li>

								<li><a href="#">Listings</a>
									<ul>
										<li><a href="#">List Layout</a>
											<ul>
												<li><a href="listings-list-with-sidebar.html">With Sidebar</a></li>
												<li><a href="listings-list-full-width.html">Full Width</a></li>
												<li><a href="listings-list-full-width-with-map.html">Full Width +
														Map</a></li>
											</ul>
										</li>
										<li><a href="#">Grid Layout</a>
											<ul>
												<li><a href="listings-grid-with-sidebar-1.html">With Sidebar 1</a></li>
												<li><a href="listings-grid-with-sidebar-2.html">With Sidebar 2</a></li>
												<li><a href="listings-grid-full-width.html">Full Width</a></li>
												<li><a href="listings-grid-full-width-with-map.html">Full Width +
														Map</a></li>
											</ul>
										</li>
										<li><a href="#">Half Screen Map</a>
											<ul>
												<li><a href="listings-half-screen-map-list.html">List Layout</a></li>
												<li><a href="listings-half-screen-map-grid-1.html">Grid Layout 1</a>
												</li>
												<li><a href="listings-half-screen-map-grid-2.html">Grid Layout 2</a>
												</li>
											</ul>
										</li>
										<li><a href="#">Single Listings</a>
											<ul>
												<li><a href="listings-single-page.html">Single Listing 1</a></li>
												<li><a href="listings-single-page-2.html">Single Listing 2</a></li>
												<li><a href="listings-single-page-3.html">Single Listing 3</a></li>
											</ul>
										</li>
										<li><a href="#">Open Street Map</a>
											<ul>
												<li><a href="listings-half-screen-map-list-OpenStreetMap.html">Half
														Screen Map List Layout</a></li>
												<li><a href="listings-half-screen-map-grid-1-OpenStreetMap.html">Half
														Screen Map Grid Layout 1</a></li>
												<li><a href="listings-half-screen-map-grid-2-OpenStreetMap.html">Half
														Screen Map Grid Layout 2</a></li>
												<li><a href="listings-list-full-width-with-map-OpenStreetMap.html">Full
														Width List</a></li>
												<li><a href="listings-grid-full-width-with-map-OpenStreetMap.html">Full
														Width Grid</a></li>
												<li><a href="listings-single-page-OpenStreetMap.html">Single Listing</a>
												</li>
											</ul>
										</li>
									</ul>
								</li>

								<li><a class="current" href="#">User Panel</a>
									<ul>
										<li><a href="dashboard.html">Dashboard</a></li>
										<li><a href="dashboard-messages.html">Messages</a></li>
										<li><a href="dashboard-bookings.html">Bookings</a></li>
										<li><a href="dashboard-wallet.html">Wallet</a></li>
										<li><a href="dashboard-my-listings.html">My Listings</a></li>
										<li><a href="dashboard-reviews.html">Reviews</a></li>
										<li><a href="dashboard-bookmarks.html">Bookmarks</a></li>
										<li><a href="dashboard-add-listing.html"> 新增停車場</a></li>
										<li><a href="dashboard-my-profile.html">My Profile</a></li>
										<li><a href="dashboard-invoice.html">Invoice</a></li>
									</ul>
								</li>

								<li><a href="#">Pages</a>
									<div class="mega-menu mobile-styles three-columns">

										<div class="mega-menu-section">
											<ul>
												<li class="mega-menu-headline">Pages #1</li>
												<li><a href="pages-user-profile.html"><i class="sl sl-icon-user"></i>
														User Profile</a></li>
												<li><a href="pages-booking.html"><i class="sl sl-icon-check"></i>
														Booking Page</a></li>
												<li><a href="pages-add-listing.html"><i class="sl sl-icon-plus"></i>
														新增停車場</a></li>
												<li><a href="pages-blog.html"><i class="sl sl-icon-docs"></i> Blog</a>
												</li>
											</ul>
										</div>

										<div class="mega-menu-section">
											<ul>
												<li class="mega-menu-headline">Pages #2</li>
												<li><a href="pages-contact.html"><i
															class="sl sl-icon-envelope-open"></i> Contact</a></li>
												<li><a href="pages-coming-soon.html"><i
															class="sl sl-icon-hourglass"></i> Coming Soon</a></li>
												<li><a href="pages-404.html"><i class="sl sl-icon-close"></i> 404
														Page</a></li>
												<li><a href="pages-masonry-filtering.html"><i
															class="sl sl-icon-equalizer"></i> Masonry Filtering</a></li>
											</ul>
										</div>

										<div class="mega-menu-section">
											<ul>
												<li class="mega-menu-headline">Other</li>
												<li><a href="pages-elements.html"><i class="sl sl-icon-settings"></i>
														Elements</a></li>
												<li><a href="pages-pricing-tables.html"><i class="sl sl-icon-tag"></i>
														Pricing Tables</a></li>
												<li><a href="pages-typography.html"><i class="sl sl-icon-pencil"></i>
														Typography</a></li>
												<li><a href="pages-icons.html"><i class="sl sl-icon-diamond"></i>
														Icons</a></li>
											</ul>
										</div>

									</div>
								</li>

							</ul>
						</nav>
						<div class="clearfix"></div>
						<!-- Main Navigation / End -->

					</div>
					<!-- Left Side Content / End -->

					<!-- Right Side Content / End -->
					<div class="right-side">
						<!-- Header Widget -->
						<div class="header-widget">

							<!-- User Menu -->
							<div class="user-menu">
								<div class="user-name"><span><img src="images/dashboard-avatar.jpg" alt=""></span>Hi,
									Tom!</div>
								<ul>
									<li><a href="dashboard.html"><i class="sl sl-icon-settings"></i> Dashboard</a></li>
									<li><a href="dashboard-messages.html"><i class="sl sl-icon-envelope-open"></i>
											Messages</a></li>
									<li><a href="dashboard-bookings.html"><i class="fa fa-calendar-check-o"></i>
											Bookings</a></li>
									<li><a href="index.html"><i class="sl sl-icon-power"></i> Logout</a></li>
								</ul>
							</div>

							<a href="dashboard-add-listing.html" class="button border with-icon">新增停車場 <i
									class="sl sl-icon-plus"></i></a>
						</div>
						<!-- Header Widget / End -->
					</div>
					<!-- Right Side Content / End -->

				</div>
			</div>
			<!-- Header / End -->

		</header>
		<div class="clearfix"></div>
		<!-- Header Container / End -->


		<!-- Dashboard -->
		<div id="dashboard">

			<!-- Navigation
	================================================== -->

			<!-- Responsive Navigation Trigger -->
			<a href="#" class="dashboard-responsive-nav-trigger"><i class="fa fa-reorder"></i> Dashboard Navigation</a>

			<div class="dashboard-nav">
				<div class="dashboard-nav-inner">

					<ul data-submenu-title="Main">
						<li><a href="dashboard.html"><i class="sl sl-icon-settings"></i> 首頁</a></li>
						<li class="active"><a href="dashboard-messages.html"><i class="sl sl-icon-envelope-open"></i>
								最新消息 <span class="nav-tag messages">2</span></a></li>
						<li><a href="dashboard-bookings.html"><i class="fa fa-calendar-check-o"></i> 訂單管理</a></li>
						<li><a href="dashboard-wallet.html"><i class="sl sl-icon-wallet"></i> 本月收益</a></li>
					</ul>

					<ul data-submenu-title="Listings">
						<li><a><i class="sl sl-icon-layers"></i> 我的停車場</a>
							<ul>
								<li><a href="dashboard-my-listings.html">Active <span class="nav-tag green">6</span></a>
								</li>
								<li><a href="dashboard-my-listings.html">Pending <span
											class="nav-tag yellow">1</span></a></li>
								<li><a href="dashboard-my-listings.html">Expired <span class="nav-tag red">2</span></a>
								</li>
							</ul>
						</li>
						<li><a href="dashboard-bookmarks.html"><i class="sl sl-icon-heart"></i> 我的黑名單</a></li>
						<li><a href="dashboard-add-listing.html"><i class="sl sl-icon-plus"></i> 新增停車場</a></li>
					</ul>

					<ul data-submenu-title="Account">
						<li><a href="dashboard-my-profile.html"><i class="sl sl-icon-user"></i> 個人檔案</a></li>
						<li><a href="index.html"><i class="sl sl-icon-power"></i> 登出</a></li>
					</ul>

				</div>
			</div>
			<!-- Navigation / End -->


			<!-- Content
	================================================== -->
			<div class="dashboard-content">

				<!-- Titlebar -->
				<div id="titlebar">
					<div class="row">
						<div class="col-md-12">
							<h2>新增停車場</h2>
							<!-- Breadcrumbs -->
							<nav id="breadcrumbs">
								<ul>
									<li><a href="#">Home</a></li>
									<li><a href="#">Dashboard</a></li>
									<li>新增停車場</li>
								</ul>
							</nav>
						</div>
					</div>
				</div>

				<div class="row">
					<div class="col-lg-12">

						<div id="add-listing">

							<!-- Section -->
							<div class="add-listing-section">

								<!-- Headline -->
								<div class="add-listing-headline">
									<h3><i class="sl sl-icon-doc"></i> Basic Informations</h3>
								</div>

								<!-- Title -->
								<div class="row with-forms">
									<div class="col-md-12">
										<h5>停車場名稱 <i class="tip" data-tip-content="您的停車場名稱"></i></h5>
										<input class="search-field" type="text" id="parkingName" value="" />
									</div>
								</div>

								<div class="row with-forms">
									<div class="col-md-12">
										<h5>車位數量 <i class="tip" data-tip-content="請輸入停車場的車位數量"></i></h5>
										<input class="search-field" type="number" min="0" value="" placeholder="車位數量" />
									</div>
								</div>




							</div>
							<!-- Section / End -->

							<!-- Section -->
							<div class="add-listing-section margin-top-45">

								<!-- Headline -->
								<div class="add-listing-headline">
									<h3><i class="sl sl-icon-location"></i> Location</h3>
								</div>

								<div class="submit-section">

									<!-- Row -->
									<div class="row with-forms">

										<!-- City -->
										<div class="col-md-6">
											<h5>地區</h5>
											<select class="chosen-select-no-single">
												<option label="blank">選擇行政區</option>
												<!-- 台北市行政區 -->
												<option>中正區</option>
												<option>大同區</option>
												<option>中山區</option>
												<option>松山區</option>
												<option>大安區</option>
												<option>萬華區</option>
												<option>信義區</option>
												<option>士林區</option>
												<option>北投區</option>
												<option>內湖區</option>
												<option>南港區</option>
												<option>文山區</option>

												<!-- 新北市行政區 -->
												<option>板橋區</option>
												<option>汐止區</option>
												<option>新店區</option>
												<option>永和區</option>
												<option>中和區</option>
												<option>土城區</option>
												<option>三重區</option>
												<option>新莊區</option>
												<option>樹林區</option>
												<option>鶯歌區</option>
												<option>三峽區</option>
												<option>淡水區</option>
												<option>瑞芳區</option>
												<option>五股區</option>
												<option>泰山區</option>
												<option>林口區</option>
												<option>深坑區</option>
												<option>石碇區</option>
												<option>坪林區</option>
												<option>三芝區</option>
												<option>石門區</option>
												<option>八里區</option>
												<option>平溪區</option>
												<option>雙溪區</option>
												<option>貢寮區</option>
											</select>
										</div>

										<!-- Address -->
										<div class="col-md-6">
											<h5>地址</h5>
											<input type="text" placeholder="e.g. 964 School Street">
										</div>

									</div>
									<!-- Row / End -->

								</div>
							</div>
							<!-- Section / End -->




							<!-- Section -->
							<div class="add-listing-section margin-top-45">

								<!-- Headline -->
								<div class="add-listing-headline">
									<h3><i class="sl sl-icon-docs"></i> Google Map</h3>
								</div>



								<!-- Row -->
								<div class="row with-forms">
									<!-- 經度 -->
									<div class="col-md-4">
										<h5>經度 </h5>
										<input type="text" id="longitude">
									</div>

									<!-- 緯度 -->
									<div class="col-md-4">
										<h5>緯度 </h5>
										<input type="text" id="latitude">
									</div>
								</div>
								<!-- Section / End -->






								<!-- Section -->
								<div class="add-listing-section margin-top-45">

									<!-- Headline -->
									<div class="add-listing-headline">
										<h3><i class="sl sl-icon-book-open"></i> 價錢設定</h3>
										<!-- Switcher -->
										<label class="switch"><input type="checkbox" checked><span
												class="slider round"></span></label>
									</div>

									<div class="switcher-content">
										<table id="pricing-list-container">
											<!-- 第一列：平日收費 -->
											<tr class="pricing-list-item">
												<td>
													<i class="sl sl-icon-cursor-move"></i>
													<input type="text" value="平日收費" class="pricing-name" readonly />
													<input type="text" placeholder="Price" data-unit="USD"
														class="pricing-price" />
												</td>
											</tr>
											<!-- 第二列：假日收費 -->
											<tr class="pricing-list-item">
												<td>
													<i class="sl sl-icon-cursor-move"></i>
													<input type="text" value="假日收費" class="pricing-name" readonly />
													<input type="text" placeholder="Price" data-unit="USD"
														class="pricing-price" />
												</td>
											</tr>
										</table>
									</div>
								</div>
								<!-- Section / End -->


								<a href="#" class="button preview">建立停車場 <i class="fa fa-arrow-circle-right"></i></a>

							</div>
						</div>

						<!-- Copyrights -->
						<div class="col-md-12">
							<div class="copyrights">© 2021 Listeo. All Rights Reserved.</div>
						</div>

					</div>

				</div>
				<!-- Content / End -->


			</div>
			<!-- Dashboard / End -->


		</div>
		<!-- Wrapper / End -->

		<script src="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.9.2/dropzone.min.js"></script>

		<script>
			var apiUrl = "http://localhost:8081"; // 替換為你的後端 API 網址

			// Helper function to get input value by placeholder
			function getInputValue(placeholder) {
				const input = document.querySelector(`input[placeholder='${placeholder}']`);
				return input ? input.value : null;
			}
			document.querySelector(".button.preview").addEventListener("click", function (event) {
				event.preventDefault(); // 防止預設提交行為

				// 從 Session 中取得 ownerNo
				fetch(`${apiUrl}/owner/ownerNo`, {
					method: "GET",
					credentials: "include", // 攜帶 session
					headers: {
						"Content-Type": "application/json"
					}
				})
					.then(response => {
						if (response.ok) {
							return response.json();
						} else {
							throw new Error("無法取得 ownerNo！");
						}
					})
					.then(ownerNo => {
						// 收集表單資料
						const parkingName = document.getElementById("parkingName").value;
						const capacity = getInputValue("車位數量");
						const district = document.querySelector("select.chosen-select-no-single").value;
						const address = getInputValue("e.g. 964 School Street");
						const longitude = document.getElementById("longitude").value;
						const latitude = document.getElementById("latitude").value;

						// 平日收費和假日收費
						const pricingInputs = document.querySelectorAll(".pricing-price");
						const weekdayPrice = pricingInputs[0] ? pricingInputs[0].value : null;
						const weekendPrice = pricingInputs[1] ? pricingInputs[1].value : null;

						if (!longitude || !latitude || !weekdayPrice || !weekendPrice) {
							alert("請填寫完整的經度、緯度、平日收費和假日收費！");
							return;
						}

						// 構造後端需要的資料格式
						const parkingInfoData = {
							parkingName: parkingName,
							capacity: capacity ? parseInt(capacity) : null,
							parkingRegion: district,
							parkingLocation: address,
							parkingLong: parseFloat(longitude),
							parkingLat: parseFloat(latitude),
							workdayHourlyRate: parseFloat(weekdayPrice),
							holidayHourlyRate: parseFloat(weekendPrice),
						};

						// 發送 POST 請求到後端創建停車場
						return fetch(`${apiUrl}/owner/owners/${ownerNo}/parkingInfo`, {
							method: "POST",
							headers: {
								"Content-Type": "application/json"
							},
							body: JSON.stringify(parkingInfoData),
							credentials: "include"
						});
					})
					.then(response => {
						if (!response.ok) {
							throw new Error("新增停車場失敗");
						}

						// 檢查回應是否有內容
						return response.text().then(text => {
							return text ? JSON.parse(text) : {};  // 若無內容則返回空物件
						});
					})
					.then(data => {
						alert("停車場已成功新增");
						console.log("新增的停車場資訊：", data);
						window.location.href = "http://localhost:5500/dashboard-my-listings.html"; F
					})
					.catch(error => {
						console.error("錯誤：", error.message);
					});
			});

		</script>






		<!-- Scripts
================================================== -->
		<script type="text/javascript" src="scripts/jquery-3.6.0.min.js"></script>
		<script type="text/javascript" src="scripts/jquery-migrate-3.3.2.min.js"></script>
		<script type="text/javascript" src="scripts/mmenu.min.js"></script>
		<script type="text/javascript" src="scripts/chosen.min.js"></script>
		<script type="text/javascript" src="scripts/slick.min.js"></script>
		<script type="text/javascript" src="scripts/rangeslider.min.js"></script>
		<script type="text/javascript" src="scripts/magnific-popup.min.js"></script>
		<script type="text/javascript" src="scripts/waypoints.min.js"></script>
		<script type="text/javascript" src="scripts/counterup.min.js"></script>
		<script type="text/javascript" src="scripts/jquery-ui.min.js"></script>
		<script type="text/javascript" src="scripts/tooltips.min.js"></script>
		<script type="text/javascript" src="scripts/custom.js"></script>


		<!-- Opening hours added via JS (this is only for demo purpose) -->
		<script>
			$(".opening-day.js-demo-hours .chosen-select").each(function () {
				$(this).append('' +
					'<option></option>' +
					'<option>Closed</option>' +
					'<option>1 AM</option>' +
					'<option>2 AM</option>' +
					'<option>3 AM</option>' +
					'<option>4 AM</option>' +
					'<option>5 AM</option>' +
					'<option>6 AM</option>' +
					'<option>7 AM</option>' +
					'<option>8 AM</option>' +
					'<option>9 AM</option>' +
					'<option>10 AM</option>' +
					'<option>11 AM</option>' +
					'<option>12 AM</option>' +
					'<option>1 PM</option>' +
					'<option>2 PM</option>' +
					'<option>3 PM</option>' +
					'<option>4 PM</option>' +
					'<option>5 PM</option>' +
					'<option>6 PM</option>' +
					'<option>7 PM</option>' +
					'<option>8 PM</option>' +
					'<option>9 PM</option>' +
					'<option>10 PM</option>' +
					'<option>11 PM</option>' +
					'<option>12 PM</option>');
			});
		</script>

		<!-- DropZone | Documentation: http://dropzonejs.com -->
		<script type="text/javascript" src="scripts/dropzone.js"></script>

</body>

</html>